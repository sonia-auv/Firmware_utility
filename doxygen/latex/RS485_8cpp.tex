\hypertarget{RS485_8cpp}{}\doxysection{/home/kts-\/2/ele/sonia\+\_\+ele/\+Firmware\+\_\+utility/\+R\+S485/\+R\+S485.cpp File Reference}
\label{RS485_8cpp}\index{/home/kts-\/2/ele/sonia\_ele/Firmware\_utility/RS485/RS485.cpp@{/home/kts-\/2/ele/sonia\_ele/Firmware\_utility/RS485/RS485.cpp}}


The source file for the R\+S485 firmware interface.  


{\ttfamily \#include \char`\"{}mbed.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}rtos.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}R\+S485.\+h\char`\"{}}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{RS485_8cpp_a97eb88150be75f2a513c4b638cdde542}\label{RS485_8cpp_a97eb88150be75f2a513c4b638cdde542}} 
Raw\+Serial {\bfseries R\+S485\+::rs485} (P\+D\+\_\+5, P\+D\+\_\+6, 115200)
\item 
uint16\+\_\+t \mbox{\hyperlink{RS485_8cpp_a52d91eebad363835e600b79e720e29c8}{R\+S485\+::calculate\+Check\+Sum}} (uint8\+\_\+t slave, uint8\+\_\+t cmd, uint8\+\_\+t nb\+Byte, uint8\+\_\+t $\ast$data)
\begin{DoxyCompactList}\small\item\em calculate the checksum \end{DoxyCompactList}\item 
void \mbox{\hyperlink{RS485_8cpp_a5596cdcd1a54737a4070094bca522629}{R\+S485\+::send\+\_\+packet}} ()
\begin{DoxyCompactList}\small\item\em function that wakeup the thread waiting for a packet \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{RS485_8cpp_a348c15d01d3a96e9f2fad6cf685fbb2f}{R\+S485\+::serial\+\_\+read}} ()
\begin{DoxyCompactList}\small\item\em a blocking call that wait for a byte to be read \end{DoxyCompactList}\item 
void \mbox{\hyperlink{RS485_8cpp_a6548ee9509b393ba3a0ef3b5389192c1}{R\+S485\+::serial\+\_\+write}} (uint8\+\_\+t data)
\begin{DoxyCompactList}\small\item\em a blocking call that wait to send a byte \end{DoxyCompactList}\item 
void \mbox{\hyperlink{RS485_8cpp_a5d233be95329bed72b5cd6fdd6c187f2}{R\+S485\+::read\+\_\+thread}} ()
\begin{DoxyCompactList}\small\item\em the main reader thread \end{DoxyCompactList}\item 
void \mbox{\hyperlink{RS485_8cpp_acc537e99453dda11910886e45bc4fee6}{R\+S485\+::write\+\_\+thread}} ()
\begin{DoxyCompactList}\small\item\em the main writer thread \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{RS485_8cpp_a03cdb92e17312011128c107414107c23}{R\+S485\+::read}} (uint8\+\_\+t $\ast$cmd\+\_\+array, uint8\+\_\+t nb\+\_\+command, uint8\+\_\+t $\ast$data\+\_\+buffer)
\begin{DoxyCompactList}\small\item\em the user function to read on R\+S485 \end{DoxyCompactList}\item 
void \mbox{\hyperlink{RS485_8cpp_a544b8f600f3b6de7876f128d7c978199}{R\+S485\+::write}} (uint8\+\_\+t slave, uint8\+\_\+t cmd, uint8\+\_\+t nb\+\_\+byte, uint8\+\_\+t $\ast$data\+\_\+buffer)
\begin{DoxyCompactList}\small\item\em the user function to write on R\+S485 \end{DoxyCompactList}\item 
void \mbox{\hyperlink{RS485_8cpp_aacefb1817774bf9d39b38a5c0b5c0362}{R\+S485\+::init}} (uint8\+\_\+t adress, uint32\+\_\+t prefered\+\_\+sleep\+\_\+time)
\begin{DoxyCompactList}\small\item\em the init function for R\+S485 \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{RS485_8cpp_a5a419ccb24452867bf997010198005bd}\label{RS485_8cpp_a5a419ccb24452867bf997010198005bd}} 
Thread {\bfseries R\+S485\+::read\+Thread}
\item 
\mbox{\Hypertarget{RS485_8cpp_a5a0b2c50f33c230ff69ffa927b8464ce}\label{RS485_8cpp_a5a0b2c50f33c230ff69ffa927b8464ce}} 
Thread {\bfseries R\+S485\+::write\+Thread}
\item 
\mbox{\Hypertarget{RS485_8cpp_a83aeaf2edc76df1f8838badc2dc49e5a}\label{RS485_8cpp_a83aeaf2edc76df1f8838badc2dc49e5a}} 
Event\+Flags {\bfseries R\+S485\+::event}
\item 
\mbox{\Hypertarget{RS485_8cpp_afc9e72458d98705cf55ebbb7c6c01268}\label{RS485_8cpp_afc9e72458d98705cf55ebbb7c6c01268}} 
uint8\+\_\+t {\bfseries R\+S485\+::packet\+\_\+count} = 0
\item 
\mbox{\Hypertarget{RS485_8cpp_a1afb3d24d91b47788024b98088e1ce1c}\label{RS485_8cpp_a1afb3d24d91b47788024b98088e1ce1c}} 
uint32\+\_\+t {\bfseries R\+S485\+::event\+\_\+flag} = 0
\item 
\mbox{\Hypertarget{RS485_8cpp_a02760ac074d1d2ff64e63951e41d3f6e}\label{RS485_8cpp_a02760ac074d1d2ff64e63951e41d3f6e}} 
uint8\+\_\+t {\bfseries R\+S485\+::board\+\_\+adress}
\item 
\mbox{\Hypertarget{RS485_8cpp_ad322feb9f4d24a9a91f45aa1a5ed508d}\label{RS485_8cpp_ad322feb9f4d24a9a91f45aa1a5ed508d}} 
uint32\+\_\+t {\bfseries R\+S485\+::sleep\+\_\+time}
\item 
\mbox{\Hypertarget{RS485_8cpp_a2509ba8bc437cb2b51a529748d5889d0}\label{RS485_8cpp_a2509ba8bc437cb2b51a529748d5889d0}} 
R\+S485\+\_\+reader\+\_\+message {\bfseries R\+S485\+::packet\+\_\+array} \mbox{[}P\+A\+C\+K\+E\+T\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+ZE\mbox{]}
\item 
\mbox{\Hypertarget{RS485_8cpp_a4de10d8f7b84d6df0ce46c9f758434de}\label{RS485_8cpp_a4de10d8f7b84d6df0ce46c9f758434de}} 
Queue$<$ R\+S485\+\_\+writer\+\_\+message, W\+R\+I\+T\+E\+R\+\_\+\+Q\+U\+E\+U\+E\+\_\+\+S\+I\+ZE $>$ {\bfseries R\+S485\+::writer\+\_\+queue}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
The source file for the R\+S485 firmware interface. 



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{RS485_8cpp_file_a52d91eebad363835e600b79e720e29c8}\label{RS485_8cpp_file_a52d91eebad363835e600b79e720e29c8}} 
\index{RS485.cpp@{RS485.cpp}!calculateCheckSum@{calculateCheckSum}}
\index{calculateCheckSum@{calculateCheckSum}!RS485.cpp@{RS485.cpp}}
\doxysubsubsection{\texorpdfstring{calculateCheckSum()}{calculateCheckSum()}}
{\footnotesize\ttfamily uint16\+\_\+t R\+S485\+::calculate\+Check\+Sum (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{slave,  }\item[{uint8\+\_\+t}]{cmd,  }\item[{uint8\+\_\+t}]{nb\+Byte,  }\item[{uint8\+\_\+t $\ast$}]{data }\end{DoxyParamCaption})}



calculate the checksum 


\begin{DoxyParams}{Parameters}
{\em slave} & \\
\hline
{\em cmd} & \\
\hline
{\em nb\+Byte} & \\
\hline
{\em data} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
uint16\+\_\+t 
\end{DoxyReturn}
\mbox{\Hypertarget{RS485_8cpp_file_aacefb1817774bf9d39b38a5c0b5c0362}\label{RS485_8cpp_file_aacefb1817774bf9d39b38a5c0b5c0362}} 
\index{RS485.cpp@{RS485.cpp}!init@{init}}
\index{init@{init}!RS485.cpp@{RS485.cpp}}
\doxysubsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily void R\+S485\+::init (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{adress,  }\item[{uint32\+\_\+t}]{prefered\+\_\+sleep\+\_\+time }\end{DoxyParamCaption})}



the init function for R\+S485 


\begin{DoxyParams}{Parameters}
{\em adress} & the slave address of the current board \\
\hline
{\em prefered\+\_\+sleep\+\_\+time} & the time(in ms) that the writer and reader thread should wait if there\textquotesingle{}s no data to process. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{RS485_8cpp_file_a03cdb92e17312011128c107414107c23}\label{RS485_8cpp_file_a03cdb92e17312011128c107414107c23}} 
\index{RS485.cpp@{RS485.cpp}!read@{read}}
\index{read@{read}!RS485.cpp@{RS485.cpp}}
\doxysubsubsection{\texorpdfstring{read()}{read()}}
{\footnotesize\ttfamily uint8\+\_\+t R\+S485\+::read (\begin{DoxyParamCaption}\item[{uint8\+\_\+t $\ast$}]{cmd\+\_\+array,  }\item[{uint8\+\_\+t}]{nb\+\_\+command,  }\item[{uint8\+\_\+t $\ast$}]{data\+\_\+buffer }\end{DoxyParamCaption})}



the user function to read on R\+S485 


\begin{DoxyParams}{Parameters}
{\em cmd\+\_\+array} & an array that contains the command the thread need to receive to wakeup. \\
\hline
{\em nb\+\_\+command} & the number of command. \\
\hline
{\em data\+\_\+buffer} & the buffer where the byte gonna be written. The buffer should be of size 255. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
uint8\+\_\+t the number of byte received. 
\end{DoxyReturn}
\mbox{\Hypertarget{RS485_8cpp_file_a5d233be95329bed72b5cd6fdd6c187f2}\label{RS485_8cpp_file_a5d233be95329bed72b5cd6fdd6c187f2}} 
\index{RS485.cpp@{RS485.cpp}!read\_thread@{read\_thread}}
\index{read\_thread@{read\_thread}!RS485.cpp@{RS485.cpp}}
\doxysubsubsection{\texorpdfstring{read\_thread()}{read\_thread()}}
{\footnotesize\ttfamily void R\+S485\+::read\+\_\+thread (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



the main reader thread 

\mbox{\Hypertarget{RS485_8cpp_file_a5596cdcd1a54737a4070094bca522629}\label{RS485_8cpp_file_a5596cdcd1a54737a4070094bca522629}} 
\index{RS485.cpp@{RS485.cpp}!send\_packet@{send\_packet}}
\index{send\_packet@{send\_packet}!RS485.cpp@{RS485.cpp}}
\doxysubsubsection{\texorpdfstring{send\_packet()}{send\_packet()}}
{\footnotesize\ttfamily void R\+S485\+::send\+\_\+packet (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



function that wakeup the thread waiting for a packet 

\mbox{\Hypertarget{RS485_8cpp_file_a348c15d01d3a96e9f2fad6cf685fbb2f}\label{RS485_8cpp_file_a348c15d01d3a96e9f2fad6cf685fbb2f}} 
\index{RS485.cpp@{RS485.cpp}!serial\_read@{serial\_read}}
\index{serial\_read@{serial\_read}!RS485.cpp@{RS485.cpp}}
\doxysubsubsection{\texorpdfstring{serial\_read()}{serial\_read()}}
{\footnotesize\ttfamily uint8\+\_\+t R\+S485\+::serial\+\_\+read (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



a blocking call that wait for a byte to be read 

\begin{DoxyReturn}{Returns}
uint8\+\_\+t the value that\textquotesingle{}ve been read 
\end{DoxyReturn}
\mbox{\Hypertarget{RS485_8cpp_file_a6548ee9509b393ba3a0ef3b5389192c1}\label{RS485_8cpp_file_a6548ee9509b393ba3a0ef3b5389192c1}} 
\index{RS485.cpp@{RS485.cpp}!serial\_write@{serial\_write}}
\index{serial\_write@{serial\_write}!RS485.cpp@{RS485.cpp}}
\doxysubsubsection{\texorpdfstring{serial\_write()}{serial\_write()}}
{\footnotesize\ttfamily void R\+S485\+::serial\+\_\+write (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{data }\end{DoxyParamCaption})}



a blocking call that wait to send a byte 


\begin{DoxyParams}{Parameters}
{\em data} & the byte to be send \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{RS485_8cpp_file_a544b8f600f3b6de7876f128d7c978199}\label{RS485_8cpp_file_a544b8f600f3b6de7876f128d7c978199}} 
\index{RS485.cpp@{RS485.cpp}!write@{write}}
\index{write@{write}!RS485.cpp@{RS485.cpp}}
\doxysubsubsection{\texorpdfstring{write()}{write()}}
{\footnotesize\ttfamily void R\+S485\+::write (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{slave,  }\item[{uint8\+\_\+t}]{cmd,  }\item[{uint8\+\_\+t}]{nb\+\_\+byte,  }\item[{uint8\+\_\+t $\ast$}]{data\+\_\+buffer }\end{DoxyParamCaption})}



the user function to write on R\+S485 


\begin{DoxyParams}{Parameters}
{\em slave} & the slave address the message should be send to \\
\hline
{\em cmd} & the cmd to send to the message \\
\hline
{\em nb\+\_\+byte} & the number of byte to be send \\
\hline
{\em data\+\_\+buffer} & the buffer of the data to be send \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{RS485_8cpp_file_acc537e99453dda11910886e45bc4fee6}\label{RS485_8cpp_file_acc537e99453dda11910886e45bc4fee6}} 
\index{RS485.cpp@{RS485.cpp}!write\_thread@{write\_thread}}
\index{write\_thread@{write\_thread}!RS485.cpp@{RS485.cpp}}
\doxysubsubsection{\texorpdfstring{write\_thread()}{write\_thread()}}
{\footnotesize\ttfamily void R\+S485\+::write\+\_\+thread (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



the main writer thread 

